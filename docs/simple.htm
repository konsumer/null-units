<html>
  <head>
    <title>null-units</title>
    <link rel="icon" type="image/x-icon" href="https://avatars.githubusercontent.com/u/10213618" />
    <style>
      body {
        font-family: sans-serif;
      }
      fieldset * {
        display: block;
      }
      fieldset label {
        display: inline-block;
        user-select: none;
      }
    </style>
  </head>
  <body>
    <p>Click to start</p>
  </body>
  <script type="module">
    import NullManager from './null-manager.js'

    // this is just meant for quick lil tests of a single unit

    // click to play
    async function oneTimeClick() {
      document.removeEventListener('click', oneTimeClick)
      document.body.innerHTML = ''

      const units = new NullManager()
      const audioOutID = 0

      const scopeID = units.scopeNode()
      const sourceID = units.oscNode()
      const testID = await units.load('bbd')

      document.body.appendChild(units.genui(sourceID))
      document.body.appendChild(units.genui(testID))
      document.body.appendChild(units.genui(scopeID))

      units.connect(sourceID, 0, testID, 0)
      units.connect(testID, 0, scopeID, 0)
      units.connect(testID, 0, audioOutID, 0)

      const rickRoll = [
          [57, 250], [59, 250],
          [74, 400], [71, 100],
          [78, 250], [78, 250], [76, 500],

          [57, 250], [59, 250],
          [74, 400], [71, 100],
          [76, 250], [76, 250], [74, 200], [73, 150], [71, 150],

          [57, 250], [59, 250],
          [74, 400], [71, 100],
          [74, 250], [76, 250], [73, 250],
          [69, 250], [69, 250], [76, 250], [74, 500]
      ]

      let pos = 0
      function playNext() {
          if (pos >= rickRoll.length) pos = 0
          const [note, duration] = rickRoll[pos++]
          units.set_param(sourceID, 'note', note)
          setTimeout(playNext, duration * 1.5)
      }
      playNext()
    }

    // click to play
    document.addEventListener('click', oneTimeClick)
  </script>
</html>
